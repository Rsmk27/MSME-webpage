<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>STM32 Programming — MSME Docs</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<header class="topbar">
  <button class="hamburger" id="hamburger" aria-label="Toggle menu">&#9776;</button>
  <a href="index.html" class="topbar-logo">
    <div class="logo-icon">M</div>
    <div>
      <span class="logo-text">MSME Docs</span>
      <span class="logo-sub">Embedded Systems Workshop</span>
    </div>
  </a>
  <div class="topbar-spacer"></div>
  <span class="topbar-badge">&#127979; Workshop</span>
</header>

<div class="overlay" id="overlay"></div>

<aside class="sidebar" id="sidebar">
  <nav>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Navigation</div>
      <ul>
        <li><a href="index.html"><span class="nav-icon">&#127968;</span> Home</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Setup &amp; Tools</div>
      <ul>
        <li><a href="getting-started.html"><span class="nav-icon">&#128640;</span> Getting Started</a></li>
        <li><a href="hardware.html"><span class="nav-icon">&#9881;</span> Hardware Reference</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Programming</div>
      <ul>
        <li><a href="programming.html" class="active"><span class="nav-icon">&#128187;</span> STM32 Programming</a></li>
        <li><a href="sensors.html"><span class="nav-icon">&#128268;</span> Sensors &amp; Interfaces</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Advanced Topics</div>
      <ul>
        <li><a href="iot.html"><span class="nav-icon">&#127760;</span> IoT &amp; Cloud</a></li>
        <li><a href="linux.html"><span class="nav-icon">&#128032;</span> Linux Tools</a></li>
      </ul>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-title">Workshop</div>
      <ul>
        <li><a href="workshop.html"><span class="nav-icon">&#128203;</span> Workshop Materials</a></li>
        <li><a href="projects.html"><span class="nav-icon">&#129302;</span> Projects</a></li>
      </ul>
    </div>
  </nav>
</aside>

<div class="main-wrapper">
  <main class="main-content">

    <div class="page-header">
      <div class="breadcrumb"><a href="index.html">Home</a> › STM32 Programming</div>
      <h1>&#128187; STM32 Programming</h1>
      <p>From blinking your first LED to ARM Cortex-M4 architecture — practical guides for STM32 embedded development using the HAL library.</p>
    </div>

    <!-- Blinking LED -->
    <div class="content-section" id="blink">
      <h2>&#128161; Blinking LED — Hello World</h2>

      <p>Blinking an LED is the embedded equivalent of "Hello World". We'll toggle the onboard green LED (LD2, connected to <strong>PA5</strong>) on the NUCLEO-F446RE using the STM32 HAL library.</p>

      <div class="callout info">
        <span class="callout-icon">&#8505;</span>
        <span>Make sure STM32CubeIDE is installed and a new project for the <strong>NUCLEO-F446RE</strong> is set up before proceeding. See <a href="getting-started.html#cubeide">Getting Started</a>.</span>
      </div>

      <h3>1. Configure PA5 in CubeMX</h3>
      <ol class="step-list">
        <li>Open the <code>.ioc</code> file in your project to launch STM32CubeMX.</li>
        <li>Click on pin <strong>PA5</strong> on the chip diagram and select <em>GPIO_Output</em>.</li>
        <li>In <em>GPIO</em> settings, label it <code>LD2</code> and set the initial output level to <em>Low</em>.</li>
        <li>Click <strong>Project → Generate Code</strong>.</li>
      </ol>

      <h3>2. Write the Blink Code</h3>
      <p>Add the toggle call inside the <code>while(1)</code> loop in <code>Core/Src/main.c</code>:</p>

      <div class="code-block"><pre><span class="cm">/* USER CODE BEGIN WHILE */</span>
<span class="kw">while</span> (<span class="num">1</span>)
{
  <span class="fn">HAL_GPIO_TogglePin</span>(LD2_GPIO_Port, LD2_Pin);
  <span class="fn">HAL_Delay</span>(<span class="num">500</span>);  <span class="cm">/* 500 ms delay */</span>
  <span class="cm">/* USER CODE END WHILE */</span>
}</pre></div>

      <h3>3. Build &amp; Flash</h3>
      <ol class="step-list">
        <li>Press <kbd>Ctrl+B</kbd> to build. Verify 0 errors in the Console.</li>
        <li>Connect the NUCLEO board via USB.</li>
        <li>Press <kbd>F11</kbd> (Debug) or the Run button. The green LED should blink once per second.</li>
      </ol>

      <h3>Understanding HAL_GPIO_TogglePin</h3>
      <p>The HAL function signature is:</p>
      <div class="code-block"><pre><span class="kw">void</span> <span class="fn">HAL_GPIO_TogglePin</span>(GPIO_TypeDef* GPIOx, <span class="kw">uint16_t</span> GPIO_Pin);</pre></div>
      <ul>
        <li><code>GPIOx</code> — the GPIO port (e.g., <code>GPIOA</code>)</li>
        <li><code>GPIO_Pin</code> — the pin bitmask (e.g., <code>GPIO_PIN_5</code> for PA5)</li>
      </ul>
      <p>CubeMX generates the port/pin defines automatically when you label the pin in the IDE.</p>

      <div class="callout success">
        <span class="callout-icon">&#10003;</span>
        <span>Try changing the delay to <code>100</code> for a faster blink, or use two LEDs (external) to blink alternately with <code>HAL_GPIO_WritePin</code>.</span>
      </div>
    </div>

    <!-- ARM Programming -->
    <div class="content-section" id="arm">
      <h2>&#127381; STM32 ARM Programming for Embedded Systems</h2>

      <p>The STM32F446RE uses an ARM Cortex-M4 processor. Understanding the architecture helps you write efficient, low-level code and understand what the HAL library does under the hood.</p>

      <h3>ARM Cortex-M4 Architecture</h3>
      <table class="doc-table">
        <thead><tr><th>Feature</th><th>Details</th></tr></thead>
        <tbody>
          <tr><td>Instruction Set</td><td>Thumb-2 (16/32-bit mix)</td></tr>
          <tr><td>Pipeline</td><td>3-stage (Fetch, Decode, Execute)</td></tr>
          <tr><td>FPU</td><td>Single-precision hardware floating-point</td></tr>
          <tr><td>SIMD</td><td>DSP extensions (SIMD saturating arithmetic)</td></tr>
          <tr><td>Registers</td><td>R0–R12 (general), SP (R13), LR (R14), PC (R15)</td></tr>
          <tr><td>Stack</td><td>Full-descending stack (MSP + PSP)</td></tr>
          <tr><td>Interrupts</td><td>NVIC — up to 240 external IRQs</td></tr>
          <tr><td>Debug</td><td>SWD / JTAG with DWT, ITM trace</td></tr>
        </tbody>
      </table>

      <h3>Memory Map (STM32F446RE)</h3>
      <table class="doc-table">
        <thead><tr><th>Region</th><th>Start</th><th>End</th><th>Size</th></tr></thead>
        <tbody>
          <tr><td>Flash (code)</td><td><code>0x0800 0000</code></td><td><code>0x0807 FFFF</code></td><td>512 KB</td></tr>
          <tr><td>SRAM1</td><td><code>0x2000 0000</code></td><td><code>0x2001 BFFF</code></td><td>112 KB</td></tr>
          <tr><td>SRAM2</td><td><code>0x2001 C000</code></td><td><code>0x2001 FFFF</code></td><td>16 KB</td></tr>
          <tr><td>Peripheral bus</td><td><code>0x4000 0000</code></td><td><code>0x5FFF FFFF</code></td><td>—</td></tr>
          <tr><td>CoreSight / SCS</td><td><code>0xE000 0000</code></td><td><code>0xE00F FFFF</code></td><td>—</td></tr>
        </tbody>
      </table>

      <h3>Peripheral Access — Register vs. HAL</h3>
      <p>You can control peripherals at the register level or via the HAL abstraction:</p>

      <div class="code-block"><pre><span class="cm">/* Register-level — set PA5 high */</span>
GPIOA-&gt;BSRR = (<span class="num">1</span> &lt;&lt; <span class="num">5</span>);

<span class="cm">/* HAL — same operation */</span>
<span class="fn">HAL_GPIO_WritePin</span>(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);</pre></div>

      <h3>Clock System (RCC)</h3>
      <p>The STM32F446RE supports multiple clock sources:</p>
      <ul>
        <li><strong>HSI</strong> — 16 MHz internal RC oscillator (default on reset)</li>
        <li><strong>HSE</strong> — External crystal (up to 26 MHz)</li>
        <li><strong>PLL</strong> — Multiplied from HSI or HSE; used to reach 180 MHz</li>
        <li><strong>LSI</strong> — 32 kHz for RTC/IWDG</li>
        <li><strong>LSE</strong> — External 32.768 kHz crystal for RTC</li>
      </ul>

      <div class="code-block"><pre><span class="cm">/* Typical SystemClock_Config — 180 MHz via PLL from HSE 8 MHz */</span>
RCC_OscInitTypeDef RCC_OscInit = {<span class="num">0</span>};
RCC_OscInit.OscillatorType      = RCC_OSCILLATORTYPE_HSE;
RCC_OscInit.HSEState            = RCC_HSE_BYPASS;
RCC_OscInit.PLL.PLLState        = RCC_PLL_ON;
RCC_OscInit.PLL.PLLSource       = RCC_PLLSOURCE_HSE;
RCC_OscInit.PLL.PLLM            = <span class="num">4</span>;
RCC_OscInit.PLL.PLLN            = <span class="num">180</span>;
RCC_OscInit.PLL.PLLP            = RCC_PLLP_DIV2;
RCC_OscInit.PLL.PLLQ            = <span class="num">7</span>;
<span class="fn">HAL_RCC_OscConfig</span>(&amp;RCC_OscInit);</pre></div>

      <h3>Interrupts with NVIC</h3>
      <p>The Nested Vectored Interrupt Controller (NVIC) manages interrupt priorities and enables fast ISR entry.</p>

      <div class="code-block"><pre><span class="cm">/* Enable EXTI Line 13 interrupt (User Button on PC13) */</span>
<span class="fn">HAL_NVIC_SetPriority</span>(EXTI15_10_IRQn, <span class="num">0</span>, <span class="num">0</span>);
<span class="fn">HAL_NVIC_EnableIRQ</span>(EXTI15_10_IRQn);

<span class="cm">/* ISR callback — called automatically by HAL */</span>
<span class="kw">void</span> <span class="fn">HAL_GPIO_EXTI_Callback</span>(<span class="kw">uint16_t</span> GPIO_Pin)
{
  <span class="kw">if</span> (GPIO_Pin == GPIO_PIN_13)
  {
    <span class="fn">HAL_GPIO_TogglePin</span>(LD2_GPIO_Port, LD2_Pin);
  }
}</pre></div>

      <div class="callout warning">
        <span class="callout-icon">&#9888;</span>
        <span>Keep ISR code short. Use a flag variable and process it in the main loop for anything time-consuming.</span>
      </div>
    </div>

  </main>
  <footer class="site-footer">
    <p>&#169; 2024 MSME Embedded Systems &amp; IoT Workshop</p>
  </footer>
</div>

<script>
  const hamburger = document.getElementById('hamburger');
  const sidebar   = document.getElementById('sidebar');
  const overlay   = document.getElementById('overlay');
  hamburger.addEventListener('click', () => { sidebar.classList.toggle('open'); overlay.classList.toggle('active'); });
  overlay.addEventListener('click',   () => { sidebar.classList.remove('open'); overlay.classList.remove('active'); });
</script>
</body>
</html>
